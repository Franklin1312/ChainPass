# ğŸŸ DeTickets â€” NFT Event Ticketing Platform

> A full-stack Web3 ticketing platform where event tickets are minted as ERC-721 NFTs on Ethereum Sepolia testnet. Secure, transparent, and scalable â€” powered by smart contracts, a Node.js backend, and a React frontend with MetaMask integration.

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Solidity](https://img.shields.io/badge/Solidity-0.8.20-363636?logo=solidity)
![Network](https://img.shields.io/badge/Network-Sepolia-purple)
![React](https://img.shields.io/badge/React-18-61DAFB?logo=react)
![Node.js](https://img.shields.io/badge/Node.js-18+-339933?logo=nodedotjs)
![MongoDB](https://img.shields.io/badge/MongoDB-7.0-47A248?logo=mongodb)

---

## âœ¨ Features

- ğŸ« **NFT Tickets** â€” Each ticket is a unique ERC-721 token minted on-chain
- ğŸ’³ **MetaMask Integration** â€” Connect wallet, buy tickets, and sign transactions
- ğŸ“· **QR Code Validation** â€” Real camera scanning for entry gate validation
- ğŸ” **Owner Controls** â€” Create events, deactivate sales, withdraw revenue
- ğŸ“¡ **Live Blockchain Sync** â€” WebSocket listener keeps MongoDB in sync with on-chain events
- ğŸŒ **REST API** â€” Full backend API for events, tickets, and validation
- ğŸ¨ **Sleek Dark UI** â€” Space Grotesk font, gold accents, glassmorphism design

---

## ğŸ— Tech Stack

| Layer | Technology |
|---|---|
| Smart Contract | Solidity, ERC-721, OpenZeppelin |
| Development | Hardhat, Ethers.js v6 |
| Blockchain | Ethereum Sepolia Testnet |
| Backend | Node.js, Express.js, MongoDB, Mongoose |
| Blockchain Listener | Ethers.js WebSocket Provider |
| Frontend | React 18, React Router v6 |
| Wallet | Ethers.js v6, MetaMask |
| QR Codes | html5-qrcode, QR Server API |
| Styling | CSS-in-JS, Space Grotesk, Material Icons |

---

## ğŸ“ Project Structure

```
detickets/
â”‚
â”œâ”€â”€ hardhat.config.js
â”œâ”€â”€ .env                             â† Hardhat env vars
â”‚
â”œâ”€â”€ contracts/
â”‚   â””â”€â”€ Deticket.sol                 â† ERC-721 smart contract
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ deploy.js                    â† Hardhat deployment script
â”‚
â”œâ”€â”€ artifacts/                       â† Auto-generated by Hardhat compile
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ index.js                     â† Express server entry point
â”‚   â”œâ”€â”€ .env                         â† Backend environment variables
â”‚   â”œâ”€â”€ abi/
â”‚   â”‚   â””â”€â”€ EventTicketPlatform.json â† Contract ABI (copy from artifacts)
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ connect.js               â† MongoDB connection
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ Event.js
â”‚   â”‚   â””â”€â”€ Ticket.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ events.js
â”‚   â”‚   â”œâ”€â”€ tickets.js
â”‚   â”‚   â””â”€â”€ validate.js
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ listener.js              â† Real-time blockchain event listener
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ syncEvents.js            â† Manually sync missed events
â”‚       â””â”€â”€ syncTickets.js           â† Manually sync missed tickets
â”‚
â””â”€â”€ frontend/
    â”œâ”€â”€ package.json
    â””â”€â”€ src/
        â”œâ”€â”€ App.js
        â”œâ”€â”€ index.js
        â”œâ”€â”€ index.css
        â”œâ”€â”€ abi/
        â”‚   â””â”€â”€ EventTicketPlatform.json â† Contract ABI (copy from artifacts)
        â”œâ”€â”€ context/
        â”‚   â””â”€â”€ WalletContext.js     â† Global MetaMask + contract state
        â”œâ”€â”€ components/
        â”‚   â””â”€â”€ Sidebar.js           â† Navigation sidebar
        â””â”€â”€ pages/
            â”œâ”€â”€ EventList.js         â† Homepage
            â”œâ”€â”€ BuyTicket.js         â† Purchase + mint ticket
            â”œâ”€â”€ MyTickets.js         â† View owned NFT tickets
            â”œâ”€â”€ AdminPanel.js        â† Owner dashboard
            â””â”€â”€ QRScanner.js         â† Camera QR entry validation
```

---

## ğŸš€ Getting Started

### Prerequisites

- [Node.js](https://nodejs.org/) v18+
- [MongoDB](https://www.mongodb.com/try/download/community) running locally
- [MetaMask](https://metamask.io/) browser extension
- [Alchemy](https://alchemy.com/) account (free tier works)
- Sepolia testnet ETH â†’ [sepoliafaucet.com](https://sepoliafaucet.com)

---

### 1. Clone the repository

```bash
git clone https://github.com/yourusername/detickets.git
cd detickets
```

### 2. Install dependencies

```bash
# Root â€” Hardhat
npm install

# Backend
cd backend && npm install

# Frontend
cd ../frontend && npm install
```

### 3. Configure environment variables

**Root `.env`**
```env
PRIVATE_KEY=your_deployer_wallet_private_key
RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
API_KEY=your_etherscan_api_key
```

**`backend/.env`**
```env
MONGO_URI=mongodb://localhost:27017/detickets
RPC_URL=https://eth-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
WS_RPC_URL=wss://eth-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
CONTRACT_ADDRESS=0xYOUR_DEPLOYED_CONTRACT_ADDRESS
OWNER_PRIVATE_KEY=your_deployer_wallet_private_key
PORT=3001
```

### 4. Compile and deploy the contract

```bash
npx hardhat compile
npx hardhat run scripts/deploy.js --network sepolia
```

Copy the printed contract address and update `CONTRACT_ADDRESS` in `backend/.env` and `frontend/src/context/WalletContext.js`.

### 5. Copy the ABI

```bash
# Windows
cp artifacts\contracts\Deticket.sol\EventTicketPlatform.json backend\abi\EventTicketPlatform.json
cp artifacts\contracts\Deticket.sol\EventTicketPlatform.json frontend\src\abi\EventTicketPlatform.json
```

### 6. Start backend

```bash
cd backend
npm run dev
# âœ… MongoDB connected
# ğŸ”— Blockchain listener started
# ğŸš€ Server running on http://localhost:3001
```

### 7. Start frontend

```bash
cd frontend
npm start
# Opens at http://localhost:3000
```

---

## ğŸŒ API Reference

| Method | Endpoint | Description |
|---|---|---|
| GET | `/api/events` | Get all events |
| GET | `/api/events/active` | Get active events only |
| GET | `/api/events/:eventId` | Get single event with tickets |
| GET | `/api/tickets/:tokenId` | Get single ticket |
| GET | `/api/tickets/owner/:address` | Get tickets by wallet address |
| GET | `/api/validate/:tokenId` | Check ticket validity status |
| POST | `/api/validate` | Validate ticket + mark used on-chain |

---

## ğŸ§­ Pages

| Page | URL | Access | Description |
|---|---|---|---|
| Events | `/` | Everyone | Browse all upcoming events |
| Buy Ticket | `/events/:id` | MetaMask required | Mint an NFT ticket |
| My Tickets | `/my-tickets` | Connected wallet | View tickets + QR codes |
| Admin Panel | `/admin` | Owner wallet only | Create events, withdraw revenue |
| QR Scanner | `/scanner` | Owner wallet only | Validate tickets at entry gate |

---

## ğŸ”„ Full User Flow

```
Owner creates event â†’ Admin Panel
        â†“
Event saved on-chain + synced to MongoDB via listener
        â†“
User connects MetaMask â†’ buys ticket â†’ pays ETH
        â†“
ERC-721 NFT minted to user's wallet on Sepolia
        â†“
Listener saves ticket to MongoDB automatically
        â†“
User opens My Tickets â†’ reveals QR code image
        â†“
Owner opens QR Scanner â†’ scans QR with camera
        â†“
Ticket validated on-chain â†’ permanently marked as used
        â†“
Owner withdraws accumulated ETH from Admin Panel
```

---

## ğŸ“¦ Smart Contract

**Deployed on Sepolia:** `0x69a25A22F86b375ae79D756B37b721EfEf4FC574`

| Function | Description | Access |
|---|---|---|
| `createEvent(name, date, venue, price, supply, maxResalePct)` | Create a new ticketed event | Owner only |
| `mintTicket(eventId, seat, metadataURI, buyer)` | Mint an NFT ticket | Public (payable) |
| `deactivateEvent(eventId)` | Stop ticket sales | Owner only |
| `markTicketAsUsed(tokenId, qrHash)` | Validate and consume a ticket | Owner only |
| `withdrawRevenue()` | Withdraw accumulated platform fees | Owner only |
| `getEventDetails(eventId)` | Read event info | Public |

---

## ğŸ›  Utility Scripts

Run these if the listener missed events while the backend was offline:

```bash
cd backend
node scripts/syncEvents.js    # sync all on-chain events to MongoDB
node scripts/syncTickets.js   # sync all on-chain tickets to MongoDB
```

---

## ğŸ¦Š MetaMask Setup

```
1. Open MetaMask â†’ click network dropdown
2. Add Network â†’ search "Sepolia Testnet" â†’ Add
3. Get free test ETH from https://sepoliafaucet.com
4. Connect wallet on the DeTickets site
```

---

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch `git checkout -b feature/my-feature`
3. Commit your changes `git commit -m "Add my feature"`
4. Push to the branch `git push origin feature/my-feature`
5. Open a Pull Request

---

## ğŸ“„ License

This project is licensed under the MIT License. See [LICENSE](LICENSE) for details.

---

## ğŸ™ Acknowledgements

- [OpenZeppelin](https://openzeppelin.com/) â€” ERC-721 contract standards
- [Hardhat](https://hardhat.org/) â€” Ethereum development environment
- [Alchemy](https://alchemy.com/) â€” Blockchain node provider
- [Ethers.js](https://ethers.org/) â€” Ethereum JavaScript library
- [Google Stitch](https://stitch.withgoogle.com/) â€” UI design

---

<div align="center">
  Built with â¤ï¸ on Ethereum
</div>
